<!DOCTYPE html>
<html>

<head>
<title>Mersh</title>
</head>

<link rel="stylesheet" type="text/css" href="../base.css" media="screen" />
<link rel="stylesheet" type="text/css" href="../pygments.css" media="screen" />

<body>

  <!--------------------------------------------------------------------------->
  <!--
  Header.
  //-->
    <div class=post-header>
      <div class=title> Building topology information </div>
    </div>

  <!--
  Content.
  //-->
  <div class=post-content>

    The mesh structure described in <a href="../Post_05_09_2016/Post_05_09_2016.html">
    previous post</a> yields access to information such as <i>"which vertices forms an edge"</i> and
    <i>"which vertices forms a triangle"</i>. However, we expect complex procudes such as meshing
    algorithm to require more intel on the underlying topology. For instance, with a mesh
    at hand, one could ask <i>"which edges are incident to a vertex ?"</i> or <i>"which triangles are
    neighbouring a triangle ?"</i>. These information can be build from the mesh elements data structure,
    and to start with, we propose to detail the set of <i>connections</i> one generally
    needs to consider in 2d or 3d triangular meshes.

    <h1>
      Vertices connected to edges and triangles
    </h1>

    To start with we consider the case of regrouping the edges and the triangles incident
    to a specific vertex in a mesh. This can be considered as the invert mapping
    of usual connectivity relations. As a first step we propose to label the position
    of a vertex within edges or triangles, namely

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">VertexLabel</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// First point label.</span>
    <span class="w">    </span><span class="n">V0</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Second point label.</span>
    <span class="w">    </span><span class="n">V1</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Third point label.</span>
    <span class="w">    </span><span class="n">V2</span><span class="w"></span>
    <span class="w"> </span><span class="p">}</span><span class="w"></span> </pre></div>
    <!--
    End snippet.
    //-->
    This rust enum is composed with three variants since a vertex is positioned
    first or second in the local numbering of an edge and first, second or
    third in the local numbering of a triangle. With this enum at hand we can propose
    a data structure to represent a vertex to edge connection

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">VertexToEdge</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Index of the edge.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">edge_index</span><span class="o">:</span><span class="w"> </span><span class="n">usize</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Position of the vertex in the edge.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">connecting_vertex</span><span class="o">:</span><span class="w"> </span><span class="n">VertexLabel</span><span class="p">,</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span></pre></div>
    <!--
    End snippet.
    //-->

    The first field in the structure represent the index of the edge in the set of
    edges of the mesh, while the second field if the position of the vertex of interest
    in the local numbering of the edge. In the same manner the data structure used
    to represent a vertex to triangle connection is

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">VertexToTri</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Index of the triangle.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">tri_index</span><span class="o">:</span><span class="w"> </span><span class="n">usize</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Position of the vertex in the triangle.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">connecting_vertex</span><span class="o">:</span><span class="w"> </span><span class="n">VertexLabel</span><span class="p">,</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span></pre></div>
    <!--
    End snippet.
    //-->

    <h1>
      Edges connected to edges and triangles
    </h1>

    For describing the connection between edges and other higher level mesh elements,
    the methodology is similar to what we have presented so far. We start by labelling
    the position of edge a triangle edge numbering. This numbering can be deduced
    from the triangle vertices, <i>e.g.</i> if a triangle is made of points with
    index I, J and K then its first, second and third edges are made of points
    [I, J], [J, K], and [K, I]. Hence, we pinpoint the position of an edge in a triangle
    using

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">EdgeLabel</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// First edge label.</span>
    <span class="w">    </span><span class="n">E0</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Second edge label.</span>
    <span class="w">    </span><span class="n">E1</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Third edge label.</span>
    <span class="w">    </span><span class="n">E2</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span></pre></div>
    <!--
    End snippet.
    //-->

    However, the information of the position in a triangle is not enough to uniquely
    define the type of connection. We also need to specify if the edge is reversed
    or not. Therefore we propose the data structure for edge positioning as

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">EdgePosition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Label of the edge within the element.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">label</span><span class="o">:</span><span class="w"> </span><span class="n">EdgeLabel</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Boolean set to true if the edge is reversed in the element.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">is_reversed</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span></pre></div>
    <!--
    End snippet.
    //-->

    Finally the describe connections between edges and triangles as follows

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">EdgeToTri</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Index of the triangle.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">tri_index</span><span class="o">:</span><span class="w"> </span><span class="n">usize</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Position of the edge in the triangle.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">connecting_edge</span><span class="o">:</span><span class="w"> </span><span class="n">EdgePosition</span><span class="p">,</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span></pre></div>
    <!--
    End snippet.
    //-->

    As far as edge to edge connections are concerned the construction varies a bit, namely

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">EdgeToEdge</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Position of the connecting vertex in the edge.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">connecting_vertex</span><span class="o">:</span><span class="w"> </span><span class="n">VertexLabel</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Conection with the neighbouring edge.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">neighbour</span><span class="o">:</span><span class="w"> </span><span class="n">VertexToEdge</span><span class="p">,</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span></pre></div>
    <!--
    End snippet.
    //-->

    The first field if the position of the connecting vertex in the edge at hand, and
    the second field is a connection between this vertex and the neighbouring edge.

    <h1>
      Triangles connected to triangles
    </h1>

    The connection between triangles can be specified also as

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">TriToTri</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Position of the connecting edge in the triangle.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">connecting_edge</span><span class="o">:</span><span class="w"> </span><span class="n">EdgeLabel</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Connection with the neighbouring triangle.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">neighbour</span><span class="o">:</span><span class="w"> </span><span class="n">EdgeToTri</span><span class="p">,</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span></pre></div>
    <!--
    End snippet.
    //-->

    where the first filed is the position of connecting edge and the second one is
    the connection between this edge and the neighbouring triangle.

    <h1> Topology data structure </h1>

    Since we have defined a mean of characterizing the connections between elements
    of a mesh, we can regroup these information into

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">VertexTopology</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Incident edges.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">incident_edges</span><span class="o">:</span><span class="w"> </span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">VertexToEdge</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Incident triangles.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">incident_tris</span><span class="o">:</span><span class="w"> </span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">VertexToTri</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span>

    <span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">EdgeTopology</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Connections with other edges.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">edge_connections</span><span class="o">:</span><span class="w"> </span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">EdgeToEdge</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Connections with triangles.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">tri_connections</span><span class="o">:</span><span class="w"> </span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">EdgeToTri</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span>

    <span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">TriTopology</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Connections with other triangles.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">tri_connections</span><span class="o">:</span><span class="w"> </span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">TriToTri</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span>
    </pre></div>
    <!--
    End snippet.
    //-->

    and finally define the complete topology of mesh as

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">Topology</span><span class="o">&lt;</span><span class="nl">&#39;a</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Number of vertices in the topology.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">nvertices</span><span class="o">:</span><span class="w"> </span><span class="n">usize</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Borrowed mesh elements the topology is based upon.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">elements</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">&#39;a</span><span class="w"> </span><span class="n">MeshElements</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Set of vertices topology information.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">vertices</span><span class="o">:</span><span class="w"> </span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">VertexTopology</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Set of edges topology information.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">edges</span><span class="o">:</span><span class="w"> </span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">EdgeTopology</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Set of triangles topology information.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">tris</span><span class="o">:</span><span class="w"> </span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">TriTopology</span><span class="o">&gt;</span><span class="p">,</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span>
    </pre></div>
    <!--
    End snippet.
    //-->

    We remark that: (1) only the structure for mesh elements in needed, hence this
    definition of the topology is either 2d or 3d; (2) only the number of vertices
    is needed to build topology information.

  </div>
  <!--------------------------------------------------------------------------->

</body>
</html>
