<div class="highlight"><pre><span class="k">pub</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">VertexLabel</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// First point label.</span>
<span class="w">    </span><span class="n">V0</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Second point label.</span>
<span class="w">    </span><span class="n">V1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Third point label.</span>
<span class="w">    </span><span class="n">V2</span><span class="w"></span>
<span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">enum</span><span class="w"> </span><span class="n">EdgeLabel</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// First edge label.</span>
<span class="w">    </span><span class="n">E0</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Second edge label.</span>
<span class="w">    </span><span class="n">E1</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Third edge label.</span>
<span class="w">    </span><span class="n">E2</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">EdgePosition</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Label of the edge within the element.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">label</span><span class="o">:</span><span class="w"> </span><span class="n">EdgeLabel</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Boolean set to true if the edge is reversed in the element.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">is_reversed</span><span class="o">:</span><span class="w"> </span><span class="kt">bool</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">VertexToEdge</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Index of the edge.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">edge_index</span><span class="o">:</span><span class="w"> </span><span class="n">usize</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Position of the vertex in the edge.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">connecting_vertex</span><span class="o">:</span><span class="w"> </span><span class="n">VertexLabel</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">VertexToTri</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Index of the triangle.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">tri_index</span><span class="o">:</span><span class="w"> </span><span class="n">usize</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Position of the vertex in the triangle.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">connecting_vertex</span><span class="o">:</span><span class="w"> </span><span class="n">VertexLabel</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">EdgeToEdge</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Position of the connecting vertex in the edge.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">connecting_vertex</span><span class="o">:</span><span class="w"> </span><span class="n">VertexLabel</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Conection with the neighbouring edge.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">neighbour</span><span class="o">:</span><span class="w"> </span><span class="n">VertexToEdge</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">EdgeToTri</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Index of the triangle.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">tri_index</span><span class="o">:</span><span class="w"> </span><span class="n">usize</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Position of the edge in the triangle.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">connecting_edge</span><span class="o">:</span><span class="w"> </span><span class="n">EdgePosition</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">TriToTri</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Position of the connecting edge in the triangle.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">connecting_edge</span><span class="o">:</span><span class="w"> </span><span class="n">EdgeLabel</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="c-Doc">/// Connection with the neighbouring triangle.</span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">neighbour</span><span class="o">:</span><span class="w"> </span><span class="n">EdgeToTri</span><span class="p">,</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">EdgeToTri</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">get_edge_position</span><span class="p">(</span><span class="n">e</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Edge</span><span class="p">,</span><span class="w"> </span><span class="n">t</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Tri</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="n">EdgePosition</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// first face.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">EdgePosition</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">label</span><span class="o">:</span><span class="w"> </span><span class="n">EdgeLabel</span><span class="o">::</span><span class="n">E0</span><span class="p">,</span><span class="w"> </span><span class="n">is_reversed</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">EdgePosition</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">label</span><span class="o">:</span><span class="w"> </span><span class="n">EdgeLabel</span><span class="o">::</span><span class="n">E0</span><span class="p">,</span><span class="w"> </span><span class="n">is_reversed</span><span class="o">:</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// second face.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">EdgePosition</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">label</span><span class="o">:</span><span class="w"> </span><span class="n">EdgeLabel</span><span class="o">::</span><span class="n">E1</span><span class="p">,</span><span class="w"> </span><span class="n">is_reversed</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">EdgePosition</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">label</span><span class="o">:</span><span class="w"> </span><span class="n">EdgeLabel</span><span class="o">::</span><span class="n">E1</span><span class="p">,</span><span class="w"> </span><span class="n">is_reversed</span><span class="o">:</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// thrid face.</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">EdgePosition</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">label</span><span class="o">:</span><span class="w"> </span><span class="n">EdgeLabel</span><span class="o">::</span><span class="n">E2</span><span class="p">,</span><span class="w"> </span><span class="n">is_reversed</span><span class="o">:</span><span class="w"> </span><span class="kc">false</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">t</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="nb">Some</span><span class="p">(</span><span class="n">EdgePosition</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">label</span><span class="o">:</span><span class="w"> </span><span class="n">EdgeLabel</span><span class="o">::</span><span class="n">E2</span><span class="p">,</span><span class="w"> </span><span class="n">is_reversed</span><span class="o">:</span><span class="w"> </span><span class="k">true</span><span class="w"> </span><span class="p">});</span><span class="w"> </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="nb">None</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="k">impl</span><span class="w"> </span><span class="n">TriToTri</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">get_common_edge</span><span class="p">(</span><span class="n">t0</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Tri</span><span class="p">,</span><span class="w"> </span><span class="n">t1</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Tri</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="nb">Option</span><span class="o">&lt;</span><span class="p">(</span><span class="n">EdgeLabel</span><span class="p">,</span><span class="w"> </span><span class="n">EdgePosition</span><span class="p">)</span><span class="o">&gt;</span><span class="w"></span>
<span class="w">    </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="c1">// first edge of tri.</span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">e01</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Edge</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">v</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">t0</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">t0</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="w"> </span><span class="n">tag</span><span class="o">:</span><span class="w"> </span><span class="n">t0</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EdgeToTri</span><span class="o">::</span><span class="n">get_edge_position</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e01</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">t1</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">is_some</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">Some</span><span class="p">((</span><span class="n">EdgeLabel</span><span class="o">::</span><span class="n">E0</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">unwrap</span><span class="p">()));</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// second edge of tri.</span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">e12</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Edge</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">v</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">t0</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">t0</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span><span class="w"> </span><span class="n">tag</span><span class="o">:</span><span class="w"> </span><span class="n">t0</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EdgeToTri</span><span class="o">::</span><span class="n">get_edge_position</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e12</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">t1</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">is_some</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">Some</span><span class="p">((</span><span class="n">EdgeLabel</span><span class="o">::</span><span class="n">E1</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">unwrap</span><span class="p">()));</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="c1">// third edge of tri.</span>
<span class="w">        </span><span class="p">{</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">e20</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Edge</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">v</span><span class="o">:</span><span class="w"> </span><span class="p">[</span><span class="n">t0</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="w"> </span><span class="n">t0</span><span class="p">.</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span><span class="w"> </span><span class="n">tag</span><span class="o">:</span><span class="w"> </span><span class="n">t0</span><span class="p">.</span><span class="n">tag</span><span class="w"> </span><span class="p">};</span><span class="w"></span>
<span class="w">            </span><span class="kd">let</span><span class="w"> </span><span class="n">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EdgeToTri</span><span class="o">::</span><span class="n">get_edge_position</span><span class="p">(</span><span class="o">&amp;</span><span class="n">e20</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">t1</span><span class="p">);</span><span class="w"></span>
<span class="w">            </span><span class="k">if</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">is_some</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="nb">Some</span><span class="p">((</span><span class="n">EdgeLabel</span><span class="o">::</span><span class="n">E2</span><span class="p">,</span><span class="w"> </span><span class="n">result</span><span class="p">.</span><span class="n">unwrap</span><span class="p">()));</span><span class="w"></span>
<span class="w">            </span><span class="p">}</span><span class="w"></span>
<span class="w">        </span><span class="p">}</span><span class="w"></span>

<span class="w">        </span><span class="nb">None</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
