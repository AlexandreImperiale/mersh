<!DOCTYPE html>
<html>

<head>
<title>Mersh</title>
</head>

<link rel="stylesheet" type="text/css" href="../base.css" media="screen" />
<link rel="stylesheet" type="text/css" href="../pygments.css" media="screen" />

<body>

  <!--------------------------------------------------------------------------->
  <!--
  Header.
  //-->
    <div class=post-header>
      <div class=title> Base tools for geometry </div>
    </div>

  <!--
  Content.
  //-->
  <div class=post-content>
    Prior to deal with the concepts of meshes and their associated elements, we
    propose to build a set of few geometrical tools - as we expect them to be of
    significant importance in the future. Starting up lightly, we will focus on
    the 2d case.

    <h1>
      Data structures for 2d points and 2d vectors
    </h1>

    Points and vectors are the simplest geometrical objects we could come up with.
    In terms of data structure they are equivalent since they are both represented
    using two coordinates - they differ however in their associated semantic. Hence,
    we first define a lower-level data structure called <span class="highlight"> <span class="n"> Coord2d </span> </span>.

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">Coord2d</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// First coordinate of geometrical element.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">x</span><span class="o">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Second coordinate of geometrical element.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">y</span><span class="o">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span> </pre></div>
    <!--
    End snippet.
    //-->

    To this data structure, we can implement some helper functions such as algebraic operations
    - i.e. linear combinations of two coordinates - or comparators - based upon user-defined threshold

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="c-Doc">/// Amplifying coordinates by a scalar coefficient.</span>
    <span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">amplify</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">Coord2d</span><span class="w"></span>
    <span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c1">// ... //</span>
    <span class="p">}</span><span class="w"></span>

    <span class="c-Doc">/// Applying linear combination to coordinates,</span>
    <span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Coord2d</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">Coord2d</span><span class="w"></span>
    <span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c1">// ... //</span>
    <span class="p">}</span><span class="w"></span>

    <span class="c-Doc">/// Creating 2d coordinate using linear combination of two coordinates.</span>
    <span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">mlt_add</span><span class="p">(</span><span class="n">a</span><span class="o">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">c0</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Coord2d</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="o">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">,</span><span class="w"> </span><span class="n">c1</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Coord2d</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Coord2d</span><span class="w"></span>
    <span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c1">// ... //</span>
    <span class="p">}</span><span class="w"></span>

    <span class="c-Doc">/// Comparing a coordinate with another one using a fixed epsilon.</span>
    <span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">equals</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Coord2d</span><span class="p">,</span><span class="w"> </span><span class="n">eps</span><span class="o">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">bool</span><span class="w"></span>
    <span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c1">// ... //</span>
    <span class="p">}</span><span class="w"></span> </pre></div>
    <!--
    End snippet.
    //-->

    Other typical tools are the computations of natural euclidan norm or squared norm - which
    appears to be useful in some critical low-level routines

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="c-Doc">/// Computing square norm of a 2d coordinate.</span>
    <span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">sq_norm</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">f64</span><span class="w"></span>
    <span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c1">// ... //</span>
    <span class="p">}</span><span class="w"></span>

    <span class="c-Doc">/// Computing norm of a 2d coordinate.</span>
    <span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">f64</span><span class="w"></span>
    <span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c1">// ... //</span>
    <span class="p">}</span><span class="w"></span> </pre></div>
    <!--
    End snippet.
    //-->

    Once we have specify the data structure of the most low level geometrical element,
    we are ready to define 2d points and vectors as

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">Pnt2d</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Coordinates associated to the point.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">coords</span><span class="o">:</span><span class="w"> </span><span class="n">Coord2d</span><span class="p">,</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span>

    <span class="k">pub</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="n">Vec2d</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="c-Doc">/// Coordinates associated to the vector.</span>
    <span class="w">    </span><span class="k">pub</span><span class="w"> </span><span class="n">coords</span><span class="o">:</span><span class="w"> </span><span class="n">Coord2d</span><span class="p">,</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span> </pre></div>
    <!--
    End snippet.
    //-->

    As we already mentioned, points or vectors internal data are equivalent. The differ
    however in their respective API.

    <h1>
      Manipulating 2d points
    </h1>

    A typical implementation function that one can expect from 2d points if the
    function that computes the distance between two points. The implementation
    of this function - using the helper routines of 2d coordinates - is the one-liner

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">distance_to</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">q</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pnt2d</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">f64</span><span class="w"></span>
    <span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="n">Coord2d</span><span class="o">::</span><span class="n">mlt_add</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">coords</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">q</span><span class="p">.</span><span class="n">coords</span><span class="p">).</span><span class="n">norm</span><span class="p">()</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span>
    </pre></div>
    <!--
    End snippet.
    //-->

    Another typical operation is the translation of a 2d point by a vector, which
    naturally gives us another 2d point. Once again using the fact that points
    and vectors share the same lower-lever data structure - for which we have
    implemented algebraic operations - the implementation of this operation is <thead>
    one-liner

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">add</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">v</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Vec2d</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Pnt2d</span><span class="w"></span>
    <span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="n">Pnt2d</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">coords</span><span class="o">:</span><span class="w"> </span><span class="n">Coord2d</span><span class="o">::</span><span class="n">mlt_add</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">coords</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">v</span><span class="p">.</span><span class="n">coords</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span>
    </pre></div>
    <!--
    End snippet.
    //-->

    Finally, another natural manipulation is the - oriented - difference between two
    points which gives us a vector, namely

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">to</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">p</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pnt2d</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">Vec2d</span><span class="w"></span>
    <span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="n">Vec2d</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">coords</span><span class="o">:</span><span class="w"> </span><span class="n">Coord2d</span><span class="o">::</span><span class="n">mlt_add</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p</span><span class="p">.</span><span class="n">coords</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="bp">self</span><span class="p">.</span><span class="n">coords</span><span class="p">)</span><span class="w"> </span><span class="p">}</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span></pre></div>
    <!--
    End snippet.
    //-->

    <h1>
      Manipulating 2d vectors
    </h1>

    In the same way, operations on 2d vectors are implemented using operations on
    the lower-level coordinate structure. For instance, we can amplify a 2d vector
    through

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">amplify</span><span class="p">(</span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="bp">self</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="o">:</span><span class="w"> </span><span class="kt">f64</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="o">&amp;</span><span class="k">mut</span><span class="w"> </span><span class="n">Vec2d</span><span class="w"></span>
    <span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="bp">self</span><span class="p">.</span><span class="n">coords</span><span class="p">.</span><span class="n">amplify</span><span class="p">(</span><span class="n">a</span><span class="p">);</span><span class="w"> </span><span class="bp">self</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span></pre></div>
    <!--
    End snippet.
    //-->

    A second example is the computation of the norm of the vector simply computed
    by

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">pub</span><span class="w"> </span><span class="k">fn</span><span class="w"> </span><span class="n">norm</span><span class="p">(</span><span class="o">&amp;</span><span class="bp">self</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">f64</span><span class="w"></span>
    <span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="bp">self</span><span class="p">.</span><span class="n">coords</span><span class="p">.</span><span class="n">norm</span><span class="p">()</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span></pre></div>
    <!--
    End snippet.
    //-->

    <h1>
      Toy example of 2d base tools
    </h1>

    As a toy example we propose to compute the area of a triangle defined as a set
    of three 2d points, and we will simplify verify that this operation is stable
    upon vector translation of the points. To start with, let use define the simple
    routine computing the area of a triangle defined from its input summits, namely

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">fn</span><span class="w"> </span><span class="n">compute_triangle_area</span><span class="p">(</span><span class="n">p0</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pnt2d</span><span class="p">,</span><span class="w"> </span><span class="n">p1</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pnt2d</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="o">:</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Pnt2d</span><span class="p">)</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">f64</span><span class="w"></span>
    <span class="p">{</span><span class="w"></span>
    <span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">v01</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p0</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p1</span><span class="p">);</span><span class="w"></span>
    <span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">v02</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p0</span><span class="p">.</span><span class="n">to</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p2</span><span class="p">);</span><span class="w"></span>
    <span class="w">    </span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">v01</span><span class="p">.</span><span class="n">coords</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v02</span><span class="p">.</span><span class="n">coords</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">v01</span><span class="p">.</span><span class="n">coords</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">v02</span><span class="p">.</span><span class="n">coords</span><span class="p">.</span><span class="n">x</span><span class="p">).</span><span class="n">abs</span><span class="p">()</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span> </pre></div>
    <!--
    End snippet.
    //-->

    With this helper function at hand we can verify that the output result is the same
    when translating the three input points by a any vector.

    <!--
    Start snippet.
    //-->
    <div class="highlight"><pre>
    <span class="k">fn</span><span class="w"> </span><span class="n">area_translated_triangle</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>

    <span class="w">    </span><span class="c1">// Defining points of triangle</span>
    <span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pnt2d</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">);</span><span class="w"></span>
    <span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pnt2d</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span><span class="w"> </span><span class="mf">0.</span><span class="p">);</span><span class="w"></span>
    <span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">p2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Pnt2d</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="mf">0.</span><span class="p">,</span><span class="w"> </span><span class="mf">1.</span><span class="p">);</span><span class="w"></span>

    <span class="w">    </span><span class="c1">// Computing triangle area.</span>
    <span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">((</span><span class="n">compute_triangle_area</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">p2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">).</span><span class="n">abs</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1e-10</span><span class="p">);</span><span class="w"></span>

    <span class="w">    </span><span class="c1">// Translating points using random vector.</span>
    <span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">u</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Vec2d</span><span class="o">::</span><span class="n">new</span><span class="p">(</span><span class="mf">3.4</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="mf">9.6</span><span class="p">);</span><span class="w"></span>

    <span class="w">    </span><span class="c1">// Recomputing area.</span>
    <span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">q0</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p0</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">u</span><span class="p">);</span><span class="w"></span>
    <span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">q1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">u</span><span class="p">);</span><span class="w"></span>
    <span class="w">    </span><span class="kd">let</span><span class="w"> </span><span class="n">q2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p2</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="o">&amp;</span><span class="n">u</span><span class="p">);</span><span class="w"></span>
    <span class="w">    </span><span class="n">assert</span><span class="o">!</span><span class="p">((</span><span class="n">compute_triangle_area</span><span class="p">(</span><span class="o">&amp;</span><span class="n">q0</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">q1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">q2</span><span class="p">)</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mf">0.5</span><span class="p">).</span><span class="n">abs</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mf">1e-10</span><span class="p">);</span><span class="w"></span>
    <span class="p">}</span><span class="w"></span> </pre></div>
    <!--
    End snippet.
    //-->

  </div>
  <!--------------------------------------------------------------------------->

</body>
</html>
